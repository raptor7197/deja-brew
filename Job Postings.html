<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Postings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f8ff; 
            color: #000000; 
            line-height: 1.6;
        }
        
        .header-title {
            color: #2c5282;
        }

        .header-subtitle {
            color: #6a7f9c;
        }

        .job-table-container {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .job-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* Ensures columns are respected */
        }

        .job-table th, .job-table td {
            padding: 0.9rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .job-table th {
            background-color: #ebf8ff; 
            color: #2d3748;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .job-table tbody tr:hover {
            background-color: #f7fafc; 
        }

        .clickable-header { /* Applied to the <th> */
            cursor: pointer;
        }
        .sortable-content { /* Applied to the inner <div> */
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sort-icon {
            font-size: 1em;
            color: #a0aec0;
            opacity: 0.5;
        }
        .clickable-header.asc .sort-icon.asc,
        .clickable-header.desc .sort-icon.desc {
            color: #2d3748;
            opacity: 1;
        }

        .pagination-controls {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 0.25rem;
        }
        .pagination-button {
            padding: 0.4rem 0.8rem;
            background-color: #ffffff;
            color: #2d3748;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .pagination-button:hover:not(.active):not(.disabled) {
            background-color: #f7fafc;
        }
        .pagination-button.active {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: #ffffff;
            font-weight: 600;
        }
        .pagination-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination-info {
            color: #718096;
            font-size: 0.9rem;
        }
        .entries-per-page-container, .search-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #2d3748;
        }
        .entries-per-page-select, .search-input {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            color: #2d3748;
            padding: 0.5rem 0.8rem;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        .search-input {
            width: 100%;
            max-width: 250px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s forwards;
        }
        
        .modal-content {
            background-color: #ffffff; 
            margin: 5% auto;
            padding: 0;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s forwards;
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.1); 
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #e2e8f0;
            position: relative;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .close {
            color: #a0aec0;
            position: absolute;
            top: 16px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: #2d3748;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .overflow-x-auto {
            overflow-x: auto;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <header class="text-center mb-8">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold header-title mb-2 tracking-tight">Discover Your Next Career</h1>
        <p class="text-base sm:text-lg header-subtitle">Explore exciting job opportunities tailored for you.</p>
    </header>

    <main class="max-w-7xl mx-auto">
         <div id="job-board-container">
             <p id="loading-message" class="text-center">Loading job listings...</p>
         </div>
    </main>

    <div id="jobModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">×</span>
                <h2 id="modalTitle" class="text-xl sm:text-2xl font-bold text-gray-800 mb-2"></h2>
                <p id="modalCompany" class="text-lg text-gray-600 mb-2"></p>
                <div id="modalTags" class="flex flex-wrap gap-2 mb-2"></div>
                <p id="modalDate" class="text-sm text-gray-500"></p>
            </div>
            <div class="modal-body">
                <h3 class="font-bold text-lg mb-2 text-gray-800">Skills</h3>
                <p id="modalSkills" class="text-gray-700 mb-4"></p>
                <h3 class="font-bold text-lg mb-2 text-gray-800">Job Description</h3>
                <div id="modalDescription" class="text-gray-700 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('jobModal');
            const closeModalBtn = document.querySelector('.close');
            let allJobsData = [];
            let currentFilteredJobs = [];

            let currentPage = 1;
            let jobsPerPage = 10;
            let currentSortColumn = 'date';
            let currentSortDirection = 'desc';
            let searchQuery = '';

            function openModal(job) {
                document.getElementById('modalTitle').textContent = job.title;
                document.getElementById('modalCompany').textContent = job.company;
                document.getElementById('modalDate').textContent = `Posted: ${job.date}`;
                document.getElementById('modalDescription').innerHTML = job.description;
                document.getElementById('modalSkills').textContent = job.skills.join(', ') || 'N/A';
                
                const tagsContainer = document.getElementById('modalTags');
                tagsContainer.innerHTML = `
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${job.category || 'General'}</span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">${job.location || 'N/A'}</span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">${job.experience || 'N/A'}</span>
                `;
                
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }

            function closeModalFunc() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            closeModalBtn.onclick = closeModalFunc;
            window.onclick = (event) => {
                if (event.target === modal) closeModalFunc();
            };
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') closeModalFunc();
            });

            function renderJobBoard() {
                let jobsToProcess = [...allJobsData];

                if (searchQuery) {
                    jobsToProcess = jobsToProcess.filter(job => 
                        Object.values(job).some(val => 
                            String(val).toLowerCase().includes(searchQuery)
                        )
                    );
                }

                jobsToProcess.sort((a, b) => {
                    let valA = a[currentSortColumn] || '';
                    let valB = b[currentSortColumn] || '';

                    if (currentSortColumn === 'date') {
                        valA = a.date.split('/').reverse().join('');
                        valB = b.date.split('/').reverse().join('');
                    } else {
                        valA = String(valA).toLowerCase();
                        valB = String(valB).toLowerCase();
                    }

                    if (valA < valB) return currentSortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return currentSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });

                currentFilteredJobs = jobsToProcess;

                const startIndex = (currentPage - 1) * jobsPerPage;
                const endIndex = startIndex + jobsPerPage;
                const paginatedJobs = currentFilteredJobs.slice(startIndex, endIndex);
                
                const boardContainer = document.getElementById('job-board-container');
                boardContainer.innerHTML = '';
                
                if (allJobsData.length === 0) {
                     boardContainer.innerHTML = '<p class="text-center">No job listings found.</p>';
                     return;
                }

                const totalEntries = currentFilteredJobs.length;
                const showingStart = totalEntries > 0 ? startIndex + 1 : 0;
                const showingEnd = Math.min(endIndex, totalEntries);

                let tableHTML = `
                    <div class="job-table-container">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                            <div class="entries-per-page-container">
                                <select id="entriesPerPage" class="entries-per-page-select">
                                    <option value="5" ${jobsPerPage === 5 ? 'selected' : ''}>5</option>
                                    <option value="10" ${jobsPerPage === 10 ? 'selected' : ''}>10</option>
                                    <option value="25" ${jobsPerPage === 25 ? 'selected' : ''}>25</option>
                                    <option value="50" ${jobsPerPage === 50 ? 'selected' : ''}>50</option>
                                </select>
                                <span>entries per page</span>
                            </div>
                            <div class="search-container w-full md:w-auto">
                                <label for="searchInput">Search:</label>
                                <input type="text" id="searchInput" class="search-input" value="${searchQuery}">
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="job-table">
                                <thead>
                                    <tr>
                                        <th class="clickable-header ${currentSortColumn === 'title' ? currentSortDirection : ''}" data-sort-by="title"><div class="sortable-content">Name <span class="sort-icon asc">▲</span><span class="sort-icon desc">▼</span></div></th>
                                        <th class="clickable-header ${currentSortColumn === 'category' ? currentSortDirection : ''}" data-sort-by="category"><div class="sortable-content">Domain <span class="sort-icon asc">▲</span><span class="sort-icon desc">▼</span></div></th>
                                        <th class="clickable-header ${currentSortColumn === 'date' ? currentSortDirection : ''}" data-sort-by="date"><div class="sortable-content">Job Posted <span class="sort-icon asc">▲</span><span class="sort-icon desc">▼</span></div></th>
                                        <th class="clickable-header ${currentSortColumn === 'location' ? currentSortDirection : ''}" data-sort-by="location"><div class="sortable-content">Location <span class="sort-icon asc">▲</span><span class="sort-icon desc">▼</span></div></th>
                                        <th class="clickable-header ${currentSortColumn === 'experience' ? currentSortDirection : ''}" data-sort-by="experience"><div class="sortable-content">Type <span class="sort-icon asc">▲</span><span class="sort-icon desc">▼</span></div></th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                if(paginatedJobs.length > 0) {
                    paginatedJobs.forEach(job => {
                        tableHTML += `
                            <tr class="cursor-pointer" data-job-id="${job.id}">
                                <td>${job.title}</td>
                                <td>${job.category}</td>
                                <td>${job.date}</td>
                                <td>${job.location}</td>
                                <td>${job.experience}</td>
                            </tr>
                        `;
                    });
                } else {
                    tableHTML += `<tr><td colspan="5" class="text-center">No jobs found matching your criteria.</td></tr>`;
                }
                
                tableHTML += `
                                </tbody>
                            </table>
                        </div>

                        <div class="flex flex-col md:flex-row justify-between items-center mt-4 gap-4">
                            <div class="pagination-info">
                                Showing ${showingStart} to ${showingEnd} of ${totalEntries} entries
                            </div>
                            <div id="pagination-controls-container" class="pagination-controls">
                                <!-- Pagination buttons will be inserted here -->
                            </div>
                        </div>
                    </div>`;

                boardContainer.innerHTML = tableHTML;
                renderPaginationControls(totalEntries);

                boardContainer.querySelectorAll('tbody tr').forEach(row => {
                    row.addEventListener('click', () => {
                        const jobId = parseInt(row.dataset.jobId);
                        const selectedJob = allJobsData.find(j => j.id === jobId);
                        if (selectedJob) openModal(selectedJob);
                    });
                });

                boardContainer.querySelectorAll('.clickable-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const sortBy = header.dataset.sortBy;
                        if (currentSortColumn === sortBy) {
                            currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                        } else {
                            currentSortColumn = sortBy;
                            currentSortDirection = 'asc';
                        }
                        currentPage = 1;
                        renderJobBoard();
                    });
                });

                document.getElementById('entriesPerPage').addEventListener('change', (event) => {
                    jobsPerPage = parseInt(event.target.value);
                    currentPage = 1;
                    renderJobBoard();
                });
                
                document.getElementById('searchInput').addEventListener('input', (event) => {
                    searchQuery = event.target.value.toLowerCase();
                    currentPage = 1;
                    renderJobBoard();
                });
            }

            function renderPaginationControls(totalJobs) {
                const paginationContainer = document.getElementById('pagination-controls-container');
                if (!paginationContainer) return;

                const totalPages = Math.ceil(totalJobs / jobsPerPage);
                if (totalPages <= 1) {
                    paginationContainer.innerHTML = '';
                    return;
                }

                let paginationHTML = `
                    <button class="pagination-button ${currentPage === 1 ? 'disabled' : ''}" data-page="${currentPage - 1}">‹</button>
                `;

                const maxPageButtons = 3;
                let startPage = Math.max(1, currentPage - 1);
                let endPage = Math.min(totalPages, startPage + maxPageButtons - 1);

                if (endPage - startPage + 1 < maxPageButtons && startPage > 1) {
                    startPage = Math.max(1, endPage - maxPageButtons + 1);
                }
                
                if (startPage > 1) {
                    paginationHTML += `<button class="pagination-button" data-page="1">1</button>`;
                    if (startPage > 2) {
                       paginationHTML += `<span class="px-2">...</span>`;
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    paginationHTML += `
                        <button class="pagination-button ${currentPage === i ? 'active' : ''}" data-page="${i}">${i}</button>
                    `;
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        paginationHTML += `<span class="px-2">...</span>`;
                    }
                    paginationHTML += `<button class="pagination-button" data-page="${totalPages}">${totalPages}</button>`;
                }

                paginationHTML += `
                    <button class="pagination-button ${currentPage === totalPages ? 'disabled' : ''}" data-page="${currentPage + 1}">›</button>
                `;
                paginationContainer.innerHTML = paginationHTML;

                paginationContainer.querySelectorAll('.pagination-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        if (button.classList.contains('disabled')) return;
                        currentPage = parseInt(button.dataset.page);
                        renderJobBoard();
                    });
                });
            }
            
            async function fetchAndRenderJobs() {
                const apiEndpoint = 'https://thedejabrew.com/wp-json/wp/v2/job';
                const loadingMsg = document.getElementById('loading-message');
                const container = document.getElementById('job-board-container');
                
                try {
                    const response = await axios.get(apiEndpoint);
                    
                    allJobsData = response.data.map(job => {
                        const formatDate = (dateStr) => {
                            if (!dateStr || dateStr.length !== 8) return 'N/A';
                            const year = dateStr.substring(0, 4);
                            const month = dateStr.substring(4, 6);
                            const day = dateStr.substring(6, 8);
                            return `${day}/${month}/${year}`;
                        };

                        return {
                            id: job.id,
                            title: job.title.rendered || 'No Title',
                            description: job.content.rendered || 'No description available.',
                            company: job.acf.company || 'N/A',
                            location: job.acf.location || 'N/A',
                            experience: job.acf.experience || 'N/A',
                            skills: job.acf.skills ? job.acf.skills.split(',').map(s => s.trim()) : [],
                            date: formatDate(job.acf.date_posted),
                            category: job.acf.category || 'General', 
                        };
                    });
                    
                    if (loadingMsg) loadingMsg.style.display = 'none';
                    renderJobBoard();

                } catch (error) {
                    console.error('Error fetching job data:', error);
                    if (loadingMsg) loadingMsg.style.display = 'none';
                    container.innerHTML = `<p class="text-center text-red-500">Failed to load job listings. Please try again later.</p>`;
                }
            }

            fetchAndRenderJobs();
        });
    </script>
</body>
</html>